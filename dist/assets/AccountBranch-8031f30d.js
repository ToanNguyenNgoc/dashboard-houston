import{r as m,w as b,c as p,F as ce,j as l,q as P,a1 as pe,a2 as le,k as _e,l as te,s as ye,A as be,a3 as we,P as Ce,C as Ne,I as Ee,a4 as Se}from"./index-c60e490b.js";import{u as Le,P as ke}from"./PhotoCamera-83bf00eb.js";import{u as G}from"./useQuery-9354becc.js";import{r as xe,i as Me,a as Te}from"./jsx-runtime_commonjs-proxy-133f3eab.js";var Y={},Pe=Me;Object.defineProperty(Y,"__esModule",{value:!0});var de=Y.default=void 0,Re=Pe(xe()),ze=Te,Fe=(0,Re.default)((0,ze.jsx)("path",{d:"M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"}),"Place");de=Y.default=Fe;function Oe(t,e){const[n,i]=m.useState([]);return m.useEffect(()=>{function o(){const r=e==null?void 0:e.filter(a=>Object.keys(a).some(u=>{var c;return(c=a[u])==null?void 0:c.toString().toLowerCase().includes(t.toString().toLowerCase())}));i(r)}o()},[t,e]),n}function Be(t){var w,k,x,z,V,A,$;const{fullAddress:e,setFullAddress:n}=t,[i,o]=m.useState(""),r=m.useRef(null),a=m.useRef(null),u=m.useRef(null),{data:c}=G({queryKey:["PROVINCES"],queryFn:()=>b.provinces(),refetchOnWindowFocus:!1}),{data:s}=G({queryKey:["DISTRICT",e==null?void 0:e.province],queryFn:()=>b.districts((e==null?void 0:e.province)??0),enabled:!!(e!=null&&e.province),refetchOnWindowFocus:!1}),{data:h}=G({queryKey:["WARD",e==null?void 0:e.district],queryFn:()=>b.wards((e==null?void 0:e.district)??0),enabled:!!(e!=null&&e.district),refetchOnWindowFocus:!1}),g=Oe(i,c==null?void 0:c.data),Q=f=>{var v;n&&n({province:f,district:(e==null?void 0:e.province)!==f?null:e==null?void 0:e.district,ward:(e==null?void 0:e.province)!==f?null:e==null?void 0:e.ward}),(v=r.current)==null||v.classList.remove("province_select_act")},L=f=>{var v;n&&n({...e,district:f,ward:(e==null?void 0:e.district)!==f?null:e==null?void 0:e.ward}),(v=a.current)==null||v.classList.remove("district_select_act")},y=f=>{var v;n&&n({...e,ward:f}),(v=u.current)==null||v.classList.remove("ward_select_act")};return window.addEventListener("click",()=>{var f,v,d;(f=r.current)==null||f.classList.remove("province_select_act"),(v=a.current)==null||v.classList.remove("district_select_act"),(d=u.current)==null||d.classList.remove("ward_select_act")}),p(ce,{children:[p("div",{className:"row mb-6",children:[l("label",{className:"col-lg-4 col-form-label required fw-bold fs-6",children:"Province"}),p("div",{onClick:f=>{var v,d;f.stopPropagation(),(v=r.current)==null||v.classList.toggle("province_select_act"),(d=a.current)==null||d.classList.remove("district_select_act")},className:"col-lg-8 fv-row province_cnt",children:[l("input",{disabled:!0,type:"text",className:"form-control form-control-lg form-control-solid",placeholder:"Province",value:((w=g==null?void 0:g.find(f=>f.code===(e==null?void 0:e.province)))==null?void 0:w.name)??"<--Choose province-->"}),p("div",{onClick:f=>f.stopPropagation(),ref:r,className:"province_select",children:[l("input",{type:"text",className:"form-control form-control-lg form-control-solid",placeholder:"Search...",onChange:f=>o(f.target.value)}),l("div",{className:"province_list",children:l("ul",{className:"list",children:g==null?void 0:g.map((f,v)=>l("li",{className:"list_item",children:l(P,{onClick:()=>Q(f.code),title:f.name,variant:"text",color:"inherit",style:(e==null?void 0:e.province)===f.code?{backgroundColor:"var(--kt-gray-200)"}:{}})},v))})})]})]})]}),p("div",{className:"row mb-6",children:[l("label",{className:"col-lg-4 col-form-label fw-bold fs-6",children:l("span",{className:"required",children:"District"})}),p("div",{onClick:f=>{var v,d;f.stopPropagation(),(v=a.current)==null||v.classList.toggle("district_select_act"),(d=u.current)==null||d.classList.remove("ward_select_act")},className:"col-lg-8 fv-row province_cnt",children:[l("input",{disabled:!0,type:"tel",className:"form-control form-control-lg form-control-solid",placeholder:"District",value:((x=(k=s==null?void 0:s.data)==null?void 0:k.find(f=>f.code===(e==null?void 0:e.district)))==null?void 0:x.name)??"<--Choose district-->"}),l("div",{onClick:f=>f.stopPropagation(),ref:a,className:"province_select",children:l("div",{style:{height:"100%"},className:"province_list",children:l("ul",{className:"list",children:(z=s==null?void 0:s.data)==null?void 0:z.map((f,v)=>l("li",{className:"list_item",children:l(P,{onClick:()=>L(f.code),title:f.name,variant:"text",color:"inherit",style:(e==null?void 0:e.district)===f.code?{backgroundColor:"var(--kt-gray-200)"}:{}})},v))})})})]})]}),p("div",{className:"row mb-6",children:[l("label",{className:"col-lg-4 col-form-label fw-bold fs-6",children:l("span",{className:"required",children:"Ward"})}),p("div",{onClick:f=>{var v;f.stopPropagation(),(v=u.current)==null||v.classList.toggle("ward_select_act")},className:"col-lg-8 fv-row province_cnt",children:[l("input",{disabled:!0,type:"text",className:"form-control form-control-lg form-control-solid",placeholder:"Ward",value:((A=(V=h==null?void 0:h.data)==null?void 0:V.find(f=>f.code===(e==null?void 0:e.ward)))==null?void 0:A.name)??"<--Choose ward-->"}),l("div",{onClick:f=>f.stopPropagation(),ref:u,className:"province_select",children:l("div",{style:{height:"100%"},className:"province_list",children:l("ul",{className:"list",children:($=h==null?void 0:h.data)==null?void 0:$.map((f,v)=>l("li",{className:"list_item",children:l(P,{onClick:()=>y(f.code),title:f.name,variant:"text",color:"inherit",style:(e==null?void 0:e.ward)===f.code?{backgroundColor:"var(--kt-gray-200)"}:{}})},v))})})})]})]})]})}const De=m.createContext(null);function qe(t){const e=t.clone();return e.pixelsToGLUnits=t.pixelsToGLUnits,e}function oe(t){return{longitude:t.center.lng,latitude:t.center.lat,zoom:t.zoom,pitch:t.pitch,bearing:t.bearing,padding:t.padding}}function ne(t,e){const n=e.viewState||e;let i=!1;if("longitude"in n&&"latitude"in n){const o=t.center;t.center=new o.constructor(n.longitude,n.latitude),i=i||o!==t.center}if("zoom"in n){const o=t.zoom;t.zoom=n.zoom,i=i||o!==t.zoom}if("bearing"in n){const o=t.bearing;t.bearing=n.bearing,i=i||o!==t.bearing}if("pitch"in n){const o=t.pitch;t.pitch=n.pitch,i=i||o!==t.pitch}return n.padding&&!t.isPaddingEqual(n.padding)&&(i=!0,t.padding=n.padding),i}const Ie=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function re(t){if(!t)return null;if(typeof t=="string"||("toJS"in t&&(t=t.toJS()),!t.layers))return t;const e={};for(const i of t.layers)e[i.id]=i;const n=t.layers.map(i=>{const o=e[i.ref];let r=null;if("interactive"in i&&(r={...i},delete r.interactive),o){r=r||{...i},delete r.ref;for(const a of Ie)a in o&&(r[a]=o[a])}return r||i});return{...t,layers:n}}function je(t,e){const n=Array.isArray(t)?t[0]:t?t.x:0,i=Array.isArray(t)?t[1]:t?t.y:0,o=Array.isArray(e)?e[0]:e?e.x:0,r=Array.isArray(e)?e[1]:e?e.y:0;return n===o&&i===r}function N(t,e){if(t===e)return!0;if(!t||!e)return!1;if(Array.isArray(t)){if(!Array.isArray(e)||t.length!==e.length)return!1;for(let n=0;n<t.length;n++)if(!N(t[n],e[n]))return!1;return!0}else if(Array.isArray(e))return!1;if(typeof t=="object"&&typeof e=="object"){const n=Object.keys(t),i=Object.keys(e);if(n.length!==i.length)return!1;for(const o of n)if(!e.hasOwnProperty(o)||!N(t[o],e[o]))return!1;return!0}return!1}const ie={mousedown:"onMouseDown",mouseup:"onMouseUp",mouseover:"onMouseOver",mousemove:"onMouseMove",click:"onClick",dblclick:"onDblClick",mouseenter:"onMouseEnter",mouseleave:"onMouseLeave",mouseout:"onMouseOut",contextmenu:"onContextMenu",touchstart:"onTouchStart",touchend:"onTouchEnd",touchmove:"onTouchMove",touchcancel:"onTouchCancel"},X={movestart:"onMoveStart",move:"onMove",moveend:"onMoveEnd",dragstart:"onDragStart",drag:"onDrag",dragend:"onDragEnd",zoomstart:"onZoomStart",zoom:"onZoom",zoomend:"onZoomEnd",rotatestart:"onRotateStart",rotate:"onRotate",rotateend:"onRotateEnd",pitchstart:"onPitchStart",pitch:"onPitch",pitchend:"onPitchEnd"},ae={wheel:"onWheel",boxzoomstart:"onBoxZoomStart",boxzoomend:"onBoxZoomEnd",boxzoomcancel:"onBoxZoomCancel",resize:"onResize",load:"onLoad",render:"onRender",idle:"onIdle",remove:"onRemove",data:"onData",styledata:"onStyleData",sourcedata:"onSourceData",error:"onError"},Ze=["minZoom","maxZoom","minPitch","maxPitch","maxBounds","projection","renderWorldCopies"],We=["scrollZoom","boxZoom","dragRotate","dragPan","keyboard","doubleClickZoom","touchZoomRotate","touchPitch"];class R{constructor(e,n,i){this._map=null,this._internalUpdate=!1,this._inRender=!1,this._hoveredFeatures=null,this._deferredEvents={move:!1,zoom:!1,pitch:!1,rotate:!1},this._onEvent=o=>{const r=this.props[ae[o.type]];r&&r(o)},this._onPointerEvent=o=>{(o.type==="mousemove"||o.type==="mouseout")&&this._updateHover(o);const r=this.props[ie[o.type]];if(r){if(this.props.interactiveLayerIds&&o.type!=="mouseover"&&o.type!=="mouseout"){const a=this._hoveredFeatures||this._map.queryRenderedFeatures(o.point,{layers:this.props.interactiveLayerIds});o.features=a}r(o),delete o.features}},this._onCameraEvent=o=>{if(!this._internalUpdate){const r=this.props[X[o.type]];r&&r(o)}o.type in this._deferredEvents&&(this._deferredEvents[o.type]=!1)},this._MapClass=e,this.props=n,this._initialize(i)}get map(){return this._map}get transform(){return this._renderTransform}setProps(e){const n=this.props;this.props=e;const i=this._updateSettings(e,n);i&&this._createShadowTransform(this._map);const o=this._updateSize(e),r=this._updateViewState(e,!0);this._updateStyle(e,n),this._updateStyleComponents(e,n),this._updateHandlers(e,n),(i||o||r&&!this._map.isMoving())&&this.redraw()}static reuse(e,n){const i=R.savedMaps.pop();if(!i)return null;const o=i.map,r=o.getContainer();for(n.className=r.className;r.childNodes.length>0;)n.appendChild(r.childNodes[0]);o._container=n,i.setProps({...e,styleDiffing:!1}),o.resize();const{initialViewState:a}=e;return a&&(a.bounds?o.fitBounds(a.bounds,{...a.fitBoundsOptions,duration:0}):i._updateViewState(a,!1)),o.isStyleLoaded()?o.fire("load"):o.once("styledata",()=>o.fire("load")),i}_initialize(e){const{props:n}=this,i={...n,...n.initialViewState,accessToken:n.mapboxAccessToken||Ue()||null,container:e,style:re(n.mapStyle)},o=i.initialViewState||i.viewState||i;if(Object.assign(i,{center:[o.longitude||0,o.latitude||0],zoom:o.zoom||0,pitch:o.pitch||0,bearing:o.bearing||0}),n.gl){const s=HTMLCanvasElement.prototype.getContext;HTMLCanvasElement.prototype.getContext=()=>(HTMLCanvasElement.prototype.getContext=s,n.gl)}const r=new this._MapClass(i);o.padding&&r.setPadding(o.padding),n.cursor&&(r.getCanvas().style.cursor=n.cursor),this._createShadowTransform(r);const a=r._render;r._render=s=>{this._inRender=!0,a.call(r,s),this._inRender=!1};const u=r._renderTaskQueue.run;r._renderTaskQueue.run=s=>{u.call(r._renderTaskQueue,s),this._onBeforeRepaint()},r.on("render",()=>this._onAfterRepaint());const c=r.fire;r.fire=this._fireEvent.bind(this,c),r.on("resize",()=>{this._renderTransform.resize(r.transform.width,r.transform.height)}),r.on("styledata",()=>this._updateStyleComponents(this.props,{})),r.on("sourcedata",()=>this._updateStyleComponents(this.props,{}));for(const s in ie)r.on(s,this._onPointerEvent);for(const s in X)r.on(s,this._onCameraEvent);for(const s in ae)r.on(s,this._onEvent);this._map=r}recycle(){R.savedMaps.push(this)}destroy(){this._map.remove()}redraw(){const e=this._map;!this._inRender&&e.style&&(e._frame&&(e._frame.cancel(),e._frame=null),e._render())}_createShadowTransform(e){const n=qe(e.transform);e.painter.transform=n,this._renderTransform=n}_updateSize(e){const{viewState:n}=e;if(n){const i=this._map;if(n.width!==i.transform.width||n.height!==i.transform.height)return i.resize(),!0}return!1}_updateViewState(e,n){if(this._internalUpdate)return!1;const i=this._map,o=this._renderTransform,{zoom:r,pitch:a,bearing:u}=o,c=i.isMoving();c&&(o.cameraElevationReference="sea");const s=ne(o,{...oe(i.transform),...e});if(c&&(o.cameraElevationReference="ground"),s&&n){const h=this._deferredEvents;h.move=!0,h.zoom||(h.zoom=r!==o.zoom),h.rotate||(h.rotate=u!==o.bearing),h.pitch||(h.pitch=a!==o.pitch)}return c||ne(i.transform,e),s}_updateSettings(e,n){const i=this._map;let o=!1;for(const r of Ze)r in e&&!N(e[r],n[r])&&(o=!0,i[`set${r[0].toUpperCase()}${r.slice(1)}`](e[r]));return o}_updateStyle(e,n){if(e.cursor!==n.cursor&&(this._map.getCanvas().style.cursor=e.cursor),e.mapStyle!==n.mapStyle){const i={diff:e.styleDiffing};return"localIdeographFontFamily"in e&&(i.localIdeographFontFamily=e.localIdeographFontFamily),this._map.setStyle(re(e.mapStyle),i),!0}return!1}_updateStyleComponents(e,n){const i=this._map;let o=!1;return i.style.loaded()&&("light"in e&&!N(e.light,n.light)&&(o=!0,i.setLight(e.light)),"fog"in e&&!N(e.fog,n.fog)&&(o=!0,i.setFog(e.fog)),"terrain"in e&&!N(e.terrain,n.terrain)&&(!e.terrain||i.getSource(e.terrain.source))&&(o=!0,i.setTerrain(e.terrain))),o}_updateHandlers(e,n){const i=this._map;let o=!1;for(const r of We){const a=e[r];N(a,n[r])||(o=!0,a?i[r].enable(a):i[r].disable())}return o}_updateHover(e){var n;const{props:i}=this;if(i.interactiveLayerIds&&(i.onMouseMove||i.onMouseEnter||i.onMouseLeave)){const r=e.type,a=((n=this._hoveredFeatures)===null||n===void 0?void 0:n.length)>0;let u;if(r==="mousemove")try{u=this._map.queryRenderedFeatures(e.point,{layers:i.interactiveLayerIds})}catch{u=[]}else u=[];const c=u.length>0;!c&&a&&(e.type="mouseleave",this._onPointerEvent(e)),this._hoveredFeatures=u,c&&!a&&(e.type="mouseenter",this._onPointerEvent(e)),e.type=r}else this._hoveredFeatures=null}_fireEvent(e,n,i){const o=this._map,r=o.transform,a=typeof n=="string"?n:n.type;return a==="move"&&this._updateViewState(this.props,!1),a in X&&(typeof n=="object"&&(n.viewState=oe(r)),this._map.isMoving())?(o.transform=this._renderTransform,e.call(o,n,i),o.transform=r,o):(e.call(o,n,i),o)}_onBeforeRepaint(){const e=this._map;this._internalUpdate=!0;for(const i in this._deferredEvents)this._deferredEvents[i]&&e.fire(i);this._internalUpdate=!1;const n=this._map.transform;this._map.transform=this._renderTransform,this._onAfterRepaint=()=>{this._map.transform=n}}}R.savedMaps=[];function Ue(){let t=null;if(typeof location<"u"){const e=/access_token=([^&\/]*)/.exec(location.search);t=e&&e[1]}try{t=t||{}.MapboxAccessToken}catch{}try{t=t||{}.REACT_APP_MAPBOX_ACCESS_TOKEN}catch{}return t}const Ve=["setMaxBounds","setMinZoom","setMaxZoom","setMinPitch","setMaxPitch","setRenderWorldCopies","setProjection","setStyle","addSource","removeSource","addLayer","removeLayer","setLayerZoomRange","setFilter","setPaintProperty","setLayoutProperty","setLight","setTerrain","setFog","remove"];function Ae(t,e){if(!t)return null;const n=t.map,i={getMap:()=>n,getCenter:()=>t.transform.center,getZoom:()=>t.transform.zoom,getBearing:()=>t.transform.bearing,getPitch:()=>t.transform.pitch,getPadding:()=>t.transform.padding,getBounds:()=>t.transform.getBounds(),project:o=>t.transform.locationPoint(e.LngLat.convert(o)),unproject:o=>t.transform.pointLocation(e.Point.convert(o)),queryTerrainElevation:(o,r)=>{const a=n.transform;n.transform=t.transform;const u=n.queryTerrainElevation(o,r);return n.transform=a,u}};for(const o of $e(n))!(o in i)&&!Ve.includes(o)&&(i[o]=n[o].bind(n));return i}function $e(t){const e=new Set;let n=t;for(;n;){for(const i of Object.getOwnPropertyNames(n))i[0]!=="_"&&typeof t[i]=="function"&&i!=="fire"&&i!=="setEventedParent"&&e.add(i);n=Object.getPrototypeOf(n)}return Array.from(e)}const He=typeof document<"u"?m.useLayoutEffect:m.useEffect,Ge=["baseApiUrl","maxParallelImageRequests","workerClass","workerCount","workerUrl"];function Ke(t,e){for(const n of Ge)n in e&&(t[n]=e[n]);e.RTLTextPlugin&&t.getRTLTextPluginStatus&&t.getRTLTextPluginStatus()==="unavailable"&&t.setRTLTextPlugin(e.RTLTextPlugin,n=>{n&&console.error(n)},!1)}const K=m.createContext(null),Qe={minZoom:0,maxZoom:22,minPitch:0,maxPitch:60,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,mapStyle:{version:8,sources:{},layers:[]},styleDiffing:!0,projection:"mercator",renderWorldCopies:!0,onError:t=>console.error(t.error),RTLTextPlugin:"https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-rtl-text/v0.2.3/mapbox-gl-rtl-text.js"},ee=m.forwardRef((t,e)=>{const n=m.useContext(De),[i,o]=m.useState(null),r=m.useRef(),{current:a}=m.useRef({mapLib:null,map:null});m.useEffect(()=>{const c=t.mapLib;let s=!0,h;return Promise.resolve(c||pe(()=>import("./mapbox-gl-0efbd455.js").then(g=>g.m),["assets/mapbox-gl-0efbd455.js","assets/index-c60e490b.js","assets/index-cebd84cf.css"])).then(g=>{if(s){if(g.Map||(g=g.default),!g||!g.Map)throw new Error("Invalid mapLib");if(g.supported(t))Ke(g,t),t.reuseMaps&&(h=R.reuse(t,r.current)),h||(h=new R(g.Map,t,r.current)),a.map=Ae(h,g),a.mapLib=g,o(h),n==null||n.onMapMount(a.map,t.id);else throw new Error("Map is not supported by this browser")}}).catch(g=>{t.onError({type:"error",target:null,originalEvent:null,error:g})}),()=>{s=!1,h&&(n==null||n.onMapUnmount(t.id),t.reuseMaps?h.recycle():h.destroy())}},[]),He(()=>{i&&i.setProps(t)}),m.useImperativeHandle(e,()=>a.map,[i]);const u=m.useMemo(()=>({position:"relative",width:"100%",height:"100%",...t.style}),[t.style]);return m.createElement("div",{id:t.id,ref:r,style:u},i&&m.createElement(K.Provider,{value:a},t.children))});ee.displayName="Map";ee.defaultProps=Qe;const Je=/box|flex|grid|column|lineHeight|fontWeight|opacity|order|tabSize|zIndex/;function S(t,e){if(!t||!e)return;const n=t.style;for(const i in e){const o=e[i];Number.isFinite(o)&&!Je.test(i)?n[i]=`${o}px`:n[i]=o}}const Xe={draggable:!1,popup:null,rotation:0,rotationAlignment:"auto",pitchAlignment:"auto"};function ue(t){const{map:e,mapLib:n}=m.useContext(K),i=m.useRef({props:t});i.current.props=t;const o=m.useMemo(()=>{let r=!1;m.Children.forEach(t.children,c=>{c&&(r=!0)});const a={...t,element:r?document.createElement("div"):null},u=new n.Marker(a).setLngLat([t.longitude,t.latitude]);return u.getElement().addEventListener("click",c=>{var s,h;(h=(s=i.current.props).onClick)===null||h===void 0||h.call(s,{type:"click",target:u,originalEvent:c})}),u.on("dragstart",c=>{var s,h;const g=c;g.lngLat=o.getLngLat(),(h=(s=i.current.props).onDragStart)===null||h===void 0||h.call(s,g)}),u.on("drag",c=>{var s,h;const g=c;g.lngLat=o.getLngLat(),(h=(s=i.current.props).onDrag)===null||h===void 0||h.call(s,g)}),u.on("dragend",c=>{var s,h;const g=c;g.lngLat=o.getLngLat(),(h=(s=i.current.props).onDragEnd)===null||h===void 0||h.call(s,g)}),u},[]);return m.useEffect(()=>(o.addTo(e.getMap()),()=>{o.remove()}),[]),m.useEffect(()=>{S(o.getElement(),t.style)},[t.style]),(o.getLngLat().lng!==t.longitude||o.getLngLat().lat!==t.latitude)&&o.setLngLat([t.longitude,t.latitude]),t.offset&&!je(o.getOffset(),t.offset)&&o.setOffset(t.offset),o.isDraggable()!==t.draggable&&o.setDraggable(t.draggable),o.getRotation()!==t.rotation&&o.setRotation(t.rotation),o.getRotationAlignment()!==t.rotationAlignment&&o.setRotationAlignment(t.rotationAlignment),o.getPitchAlignment()!==t.pitchAlignment&&o.setPitchAlignment(t.pitchAlignment),o.getPopup()!==t.popup&&o.setPopup(t.popup),le.createPortal(t.children,o.getElement())}ue.defaultProps=Xe;const Ye=m.memo(ue);function se(t){return new Set(t?t.trim().split(/\s+/):[])}function et(t){const{map:e,mapLib:n}=m.useContext(K),i=m.useMemo(()=>document.createElement("div"),[]),o=m.useRef({props:t});o.current.props=t;const r=m.useMemo(()=>{const a={...t},u=new n.Popup(a).setLngLat([t.longitude,t.latitude]);return u.once("open",c=>{var s,h;(h=(s=o.current.props).onOpen)===null||h===void 0||h.call(s,c)}),u},[]);if(m.useEffect(()=>{const a=u=>{var c,s;(s=(c=o.current.props).onClose)===null||s===void 0||s.call(c,u)};return r.on("close",a),r.setDOMContent(i).addTo(e.getMap()),()=>{r.off("close",a),r.isOpen()&&r.remove()}},[]),m.useEffect(()=>{S(r.getElement(),t.style)},[t.style]),r.isOpen()&&((r.getLngLat().lng!==t.longitude||r.getLngLat().lat!==t.latitude)&&r.setLngLat([t.longitude,t.latitude]),t.offset&&!N(r.options.offset,t.offset)&&r.setOffset(t.offset),(r.options.anchor!==t.anchor||r.options.maxWidth!==t.maxWidth)&&(r.options.anchor=t.anchor,r.setMaxWidth(t.maxWidth)),r.options.className!==t.className)){const a=se(r.options.className),u=se(t.className);for(const c of a)u.has(c)||r.removeClassName(c);for(const c of u)a.has(c)||r.addClassName(c);r.options.className=t.className}return le.createPortal(t.children,i)}m.memo(et);function U(t,e,n,i){const o=m.useContext(K),r=m.useMemo(()=>t(o),[]);return m.useEffect(()=>{const a=i||n||e,u=typeof e=="function"&&typeof n=="function"?e:null,c=typeof n=="function"?n:typeof e=="function"?e:null,{map:s}=o;return s.hasControl(r)||(s.addControl(r,a==null?void 0:a.position),u&&u(o)),()=>{c&&c(o),s.hasControl(r)&&s.removeControl(r)}},[]),r}function tt(t){const e=U(({mapLib:n})=>new n.AttributionControl(t),{position:t.position});return m.useEffect(()=>{S(e._container,t.style)},[t.style]),null}m.memo(tt);function ot(t){const e=U(({mapLib:n})=>new n.FullscreenControl({container:t.containerId&&document.getElementById(t.containerId)}),{position:t.position});return m.useEffect(()=>{S(e._controlContainer,t.style)},[t.style]),null}m.memo(ot);const me=m.forwardRef((t,e)=>{const n=m.useRef({props:t}),i=U(({mapLib:o})=>{const r=new o.GeolocateControl(t),a=r._setupUI;return r._setupUI=u=>{r._container.hasChildNodes()||a(u)},r.on("geolocate",u=>{var c,s;(s=(c=n.current.props).onGeolocate)===null||s===void 0||s.call(c,u)}),r.on("error",u=>{var c,s;(s=(c=n.current.props).onError)===null||s===void 0||s.call(c,u)}),r.on("outofmaxbounds",u=>{var c,s;(s=(c=n.current.props).onOutOfMaxBounds)===null||s===void 0||s.call(c,u)}),r.on("trackuserlocationstart",u=>{var c,s;(s=(c=n.current.props).onTrackUserLocationStart)===null||s===void 0||s.call(c,u)}),r.on("trackuserlocationend",u=>{var c,s;(s=(c=n.current.props).onTrackUserLocationEnd)===null||s===void 0||s.call(c,u)}),r},{position:t.position});return n.current.props=t,m.useImperativeHandle(e,()=>({trigger:()=>i.trigger()}),[]),m.useEffect(()=>{S(i._container,t.style)},[t.style]),null});me.displayName="GeolocateControl";m.memo(me);function nt(t){const e=U(({mapLib:n})=>new n.NavigationControl(t),{position:t.position});return m.useEffect(()=>{S(e._container,t.style)},[t.style]),null}const rt=m.memo(nt),it={unit:"metric",maxWidth:100};function fe(t){const e=U(({mapLib:n})=>new n.ScaleControl(t),{position:t.position});return(e.options.unit!==t.unit||e.options.maxWidth!==t.maxWidth)&&(e.options.maxWidth=t.maxWidth,e.setUnit(t.unit)),m.useEffect(()=>{S(e._container,t.style)},[t.style]),null}fe.defaultProps=it;m.memo(fe);const at=_e({name:te().required("Branch name is required !"),address:te().required("Branch address is required !")});function ut(){var f,v;const{handlePostMedia:t}=Le(),{handle:e,result:n,onCloseNoti:i}=ye(),{branch:o,setBranch:r}=m.useContext(be),[a,u]=m.useState({province:null,district:null,ward:null}),c=m.useRef(null),{setValue:s,getValues:h,register:g,handleSubmit:Q,formState:{errors:L}}=we({resolver:Se(at),defaultValues:{name:"",address:"",description:""}}),[y,w]=m.useState({lng:106.6923778,lat:10.7967141}),{data:k,refetch:x,isFetching:z}=G({queryKey:[o==null?void 0:o.id],queryFn:()=>b.branchById(o.id),enabled:!!o,refetchOnWindowFocus:!1,onSuccess(d){var E,C,F,O,B,D,q,I,j,Z,M,H,T;r(d==null?void 0:d.data),s("name",(E=d==null?void 0:d.data)==null?void 0:E.name),s("address",(C=d==null?void 0:d.data)==null?void 0:C.address),s("description",(F=d==null?void 0:d.data)==null?void 0:F.description),(O=d==null?void 0:d.data)!=null&&O.latitude&&((B=d==null?void 0:d.data)!=null&&B.longitude)&&w({lat:(D=d==null?void 0:d.data)==null?void 0:D.latitude,lng:(q=d==null?void 0:d.data)==null?void 0:q.longitude}),u({province:(j=(I=d==null?void 0:d.data)==null?void 0:I.province)==null?void 0:j.code,district:(M=(Z=d==null?void 0:d.data)==null?void 0:Z.district)==null?void 0:M.code,ward:(T=(H=d==null?void 0:d.data)==null?void 0:H.ward)==null?void 0:T.code})}}),V=async d=>{t({e:d,callBack:async E=>{var C;await b.putBranch(o.id,{media_id:(C=E[0])==null?void 0:C.mediaId}),x()}})},A=async d=>{a.district&&a.province&&a.ward&&e({handleFn:()=>b.putBranch(o.id,{...d,...y,province_code:a.province,district_code:a.district,ward_code:a.ward}),callback:()=>x(),messageSuccess:"Update branch success"})},$=async()=>{var d,E,C,F,O,B,D,q,I,j,Z;if(a.province&&a.district&&a.ward){const M=await b.provinces(),H=(E=(d=M==null?void 0:M.data)==null?void 0:d.find(W=>W.code===a.province))==null?void 0:E.name,T=await b.districts(a.province),he=(F=(C=T==null?void 0:T.data)==null?void 0:C.find(W=>W.code===a.district))==null?void 0:F.name,J=await b.wards(a.district),ge=(B=(O=J==null?void 0:J.data)==null?void 0:O.find(W=>W.code===a.ward))==null?void 0:B.name,ve=`${h("address")},${ge},${he},${H}`,_=await b.mapPlaces({search:ve,search_type:"address"});console.log((D=_==null?void 0:_.data[0])==null?void 0:D.center),(I=c==null?void 0:c.current)==null||I.flyTo({center:(q=_==null?void 0:_.data[0])==null?void 0:q.center.reverse()}),w({lng:(j=_==null?void 0:_.data[0])==null?void 0:j.center[0],lat:(Z=_==null?void 0:_.data[0])==null?void 0:Z.center[1]})}};return p(ce,{children:[l(Ce,{children:o==null?void 0:o.name}),l(Ne,{open:n.open,onClose:i,message:n.message,severity:n.messageColor}),l("div",{className:"card",children:l("div",{className:"branch_container",children:p("div",{className:"card mb-5 mb-xl-10",children:[l("div",{className:"card-header border-0 cursor-pointer",role:"button","data-bs-toggle":"collapse","data-bs-target":"#kt_account_profile_details","aria-expanded":"true","aria-controls":"kt_account_profile_details",children:l("div",{className:"card-title m-0",children:l("h3",{className:"fw-bolder m-0",children:"Branch Detail"})})}),l("div",{id:"kt_account_profile_details",className:"collapse show",children:p("form",{onSubmit:Q(A),noValidate:!0,className:"form",children:[p("div",{className:"card-body border-top p-9",children:[p("div",{className:"row mb-6",children:[l("label",{className:"col-lg-4 col-form-label fw-bold fs-6",children:"Branch logo"}),l("div",{className:"col-lg-8",children:p("div",{className:"image-input image-input-outline","data-kt-image-input":"true",children:[l("div",{className:"image-input-wrapper w-125px h-125px",style:{backgroundImage:`url(${(v=(f=k==null?void 0:k.data)==null?void 0:f.image)==null?void 0:v.original_url})`}}),p(Ee,{size:"large",color:"primary","aria-label":"upload picture",component:"label",children:[l("input",{onChange:V,hidden:!0,accept:"image/*",type:"file"}),l(ke,{})]})]})})]}),p("div",{className:"row mb-6",children:[l("label",{className:"col-lg-4 col-form-label required fw-bold fs-6",children:"Branch name"}),p("div",{className:"col-lg-8 fv-row",children:[l("input",{type:"text",className:"form-control form-control-lg form-control-solid",placeholder:"Branch name",...g("name")}),L.name&&l("div",{className:"fv-plugins-message-container",children:l("div",{className:"fv-help-block",children:L.name.message})})]})]}),l(Be,{fullAddress:a,setFullAddress:u}),p("div",{className:"row mb-6",children:[l("label",{className:"col-lg-4 col-form-label required fw-bold fs-6",children:"Address"}),p("div",{className:"col-lg-8 fv-row",children:[l("input",{type:"text",className:"form-control form-control-lg form-control-solid",placeholder:"Address",...g("address")}),L.address&&l("div",{className:"fv-plugins-message-container",children:l("div",{className:"fv-help-block",children:L.address.message})})]})]}),p("div",{className:"row mb-6",children:[l("label",{className:"col-lg-4 col-form-label fw-bold fs-6",children:l("span",{children:"Description"})}),l("div",{className:"col-lg-8 fv-row",children:l("input",{type:"tel",className:"form-control form-control-lg form-control-solid",placeholder:"Description",...g("description")})})]}),p("div",{className:"branch_form_map",children:[!z&&p(ee,{style:{width:"100%",height:"calc(100% - 82px)"},initialViewState:{latitude:y.lat,longitude:y.lng,zoom:16},ref:c,attributionControl:!0,mapboxAccessToken:"pk.eyJ1IjoidG9hbjA2MDExOTk4IiwiYSI6ImNsM2wzZzBpbDAxODUzcnA0cjlmb3V3OGoifQ.ndRxWrmEcI0r_E0wbJ0-6w",mapStyle:"mapbox://styles/mapbox/satellite-streets-v12",onClick:d=>w({lng:d.lngLat.lng,lat:d.lngLat.lat}),children:[l(rt,{position:"bottom-right",showZoom:!0,showCompass:!0}),l(Ye,{latitude:y.lat,longitude:y.lng,children:l(de,{fontSize:"large",color:"error"})})]}),l("div",{className:"branch_form_map_ctrl",children:p("div",{className:"row mb-6",children:[l("label",{className:"col-lg-4 col-form-label fw-bold fs-6",children:l("span",{children:"Coordinates"})}),p("div",{className:"col-lg-8 fv-row",children:[l("input",{type:"text",className:"form-control form-control-lg form-control-solid",placeholder:"Latitude",value:y.lat,onChange:d=>w({...y,lat:d.target.value})}),l("input",{type:"text",className:"form-control form-control-lg form-control-solid",placeholder:"Longitude",value:y.lng,onChange:d=>w({...y,lng:d.target.value})}),l(P,{title:"Get coordinates",onClick:$})]})]})})]})]}),p("div",{className:"card-footer d-flex justify-content-end py-6 px-9",children:[l(P,{style:{marginRight:"12px"},title:"Save",color:"success",size:"large",type:"submit",load:n.load}),l(P,{title:"Restore",color:"inherit",onClick:x,size:"large",type:"button",load:z})]})]})})]})})})]})}export{ut as default};
