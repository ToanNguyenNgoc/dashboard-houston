import{ac as B,B as C,r as c,A as N,a3 as K,w as h,j as e,c as l,q as x,F as g,P as O,s as M,y as H,I as F}from"./index-c922f188.js";import{u as D}from"./useMutation-c5582b45.js";import{u as E}from"./useQuery-31964acc.js";import{d as Q}from"./Edit-8f5699d8.js";import{d as U}from"./Delete-1cde18b4.js";import{d as z}from"./Sync-af5de35d.js";import{d as L}from"./dayjs.min-4df08ad1.js";import{B as R}from"./index-7c1994d4.js";import{U as W}from"./index-f4184864.js";import{D as $}from"./Dialog-13ad0be4.js";import{A as G}from"./Avatar-77e60bb6.js";import"./jsx-runtime_commonjs-proxy-59c53bf2.js";function P(t){const r=B(),[m]=C(a=>[a.isSPA]),{open:i,setOpen:n,id:s}=t,{branch:u}=c.useContext(N),[b,S]=c.useState(u.id),[o,f]=c.useState({media_id:null,original_url:null}),{handleSubmit:v,register:p,reset:_,setValue:d}=K({defaultValues:{villa_cate_name:"",description:""}});let y="post";s&&(y="put"),E({queryKey:["CATEGORY",s],queryFn:()=>h.villaCateById(s??0),enabled:!!(s&&i),refetchOnWindowFocus:!1,onSuccess:a=>{var w,k,A,q,I,V;d("villa_cate_name",(w=a==null?void 0:a.data)==null?void 0:w.villa_cate_name),d("description",(k=a==null?void 0:a.data)==null?void 0:k.description),f({media_id:(q=(A=a==null?void 0:a.data)==null?void 0:A.villa_cate_image)==null?void 0:q.media_id,original_url:(V=(I=a==null?void 0:a.data)==null?void 0:I.villa_cate_image)==null?void 0:V.original_url})}});const{mutate:Y,isLoading:T}=D({mutationKey:"",mutationFn:a=>y==="post"?h.postVillaCate(a):h.putVillaCate(s??0,a),onSuccess:()=>{r.invalidateQueries({queryKey:["VILLA_CATE",u.id]}),n(!1),_()}}),j=async a=>{Y({...a,branch_id:b,media_id:o.media_id})};return e($,{open:i,onClose:()=>n(!1),children:l("div",{className:"villa_cate_form",children:[e("div",{className:"form_cnt-header",children:y==="post"?"Create new category":"Update Category"}),l("div",{className:"form_cnt-body",children:[l("div",{className:"body_img_cnt",children:[e("img",{src:(o==null?void 0:o.original_url)||"",alt:""}),e("div",{className:"change_img",children:e(W,{image:o,setImage:f})})]}),e("div",{className:"body_desc_cnt",children:l("form",{onSubmit:v(j),children:[l("div",{children:[m&&l("div",{className:"form_column",children:[e("label",{className:"form-label required",children:"Branch"}),e(R,{})]}),l("div",{className:"form_column",children:[e("label",{className:"form-label required",children:"Category name"}),e("input",{type:"text",className:"form-control form-control-solid",...p("villa_cate_name",{required:!0})})]}),l("div",{className:"form_column",children:[e("label",{className:"form-label required",children:"Description"}),e("input",{type:"text",className:"form-control form-control-solid",...p("description",{required:!0})})]})]}),l("div",{className:"form_bottom",children:[e(x,{title:"Cancel",color:"error",variant:"text",onClick:()=>n(!1)}),e(x,{title:"Save",type:"submit",load:T})]})]})})]})]})})}function me(){var n;const{branch:t}=c.useContext(N),[r]=C(s=>[s.isSPA]);let m;r||(m=t==null?void 0:t.id);const{data:i}=E({queryKey:["VILLA_CATE",t.id],queryFn:()=>h.villaCates({branch_id:m}),refetchOnWindowFocus:!1});return l(g,{children:[e(O,{children:"Villa category"}),l("div",{className:"card card-account card-villa-cate",children:[e("div",{className:"card-header border-0 pt-5",children:e("div",{className:"card-toolbar",children:e(J,{})})}),e("div",{className:"card-body py-3",children:e("div",{className:"table-responsive",children:l("table",{className:"table align-middle gs-0 gy-4",children:[e("thead",{children:l("tr",{className:"fw-bold text-muted bg-light",children:[e("th",{className:"min-w-100px",children:"Icon"}),e("th",{className:"ps-4 min-w-200px rounded-start",children:"Category name"}),r&&e("th",{className:"ps-4 min-w-200px rounded-start",children:"Branch name"}),e("th",{className:"min-w-80px",children:"Status"}),e("th",{className:"min-w-200px",children:"Description"}),e("th",{className:"min-w-150px",children:"Created at"}),e("th",{className:"min-w-150px",children:"Updated at"}),e("th",{className:"min-w-100px"})]})}),e("tbody",{children:(n=i==null?void 0:i.data)==null?void 0:n.map((s,u)=>e(X,{item:s},u))})]})})})]})]})}const J=()=>{const[t,r]=c.useState(!1);return l(g,{children:[e(x,{title:"Create new category",variant:"contained",onClick:()=>r(!0)}),e(P,{open:t,setOpen:r})]})},X=({item:t})=>{var p,_;const{branch:r}=c.useContext(N),m=B(),[i]=C(d=>[d.isSPA]),[n,s]=c.useState(!1),{handle:u}=M(),[b,S]=c.useState(t.status),o=d=>{u({handleFn:()=>h.putVillaCate(t.id,{status:d.target.checked})}),S(d.target.checked)},{isLoading:f,mutate:v}=D({mutationKey:["DELETE_CATE",t.id],mutationFn:()=>h.deleteVillaCate(t.id),onSuccess:()=>{m.invalidateQueries({queryKey:["VILLA_CATE",r.id]})}});return l(g,{children:[l("tr",{children:[e("td",{children:e("span",{className:"text-muted fw-semobold text-muted d-block fs-7",children:e(G,{alt:"",src:((p=t.villa_cate_image)==null?void 0:p.original_url)??""})})}),e("td",{children:e("div",{className:"d-flex align-items-center",children:e("div",{className:"d-flex justify-content-start flex-column",children:e("span",{className:"text-dark fw-bold text-hover-primary mb-1 fs-6",children:t.villa_cate_name})})})}),i&&e("td",{children:e("div",{className:"d-flex align-items-center",children:e("div",{className:"d-flex justify-content-start flex-column",children:e("span",{className:"text-dark fw-bold  mb-1 fs-6",children:(_=t.branch)==null?void 0:_.name})})})}),e("td",{children:e("span",{className:"text-muted fw-semobold text-muted d-block fs-7",children:e(H,{onChange:o,checked:b})})}),e("td",{children:e("span",{className:"text-muted fw-semobold text-muted d-block fs-7",children:t.description})}),e("td",{children:e("span",{className:"text-muted fw-semobold text-muted d-block fs-7",children:L(t.created_at).format("DD/MM/YYYY HH:mm")})}),e("td",{children:e("span",{className:"text-muted fw-semobold text-muted d-block fs-7",children:L(t.updated_at).format("DD/MM/YYYY HH:mm")})}),l("td",{children:[e(F,{size:"small",style:{backgroundColor:"var(--kt-gray-200)"},onClick:()=>s(!0),children:e(Q,{color:"success"})}),e(F,{disabled:f,size:"small",style:{backgroundColor:"var(--kt-gray-200)",marginLeft:"8px"},onClick:()=>v(),children:f?e(z,{color:"error"}):e(U,{color:"error"})})]})]}),e(P,{open:n,setOpen:s,id:t.id})]})};export{me as default};
